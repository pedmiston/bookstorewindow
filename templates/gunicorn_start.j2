#!/bin/sh

NAME={{ app_name }}
DJANGODIR={{ app_dir }}
USER={{ gunicorn_user }}
GROUP={{ gunicorn_group }}
SOCKFILE={{ venv_dir }}/run/gunicorn.sock
NUM_WORKERS={{ gunicorn_num_workers }}
MAX_REQUESTS={{ gunicorn_max_requests }}

echo "Starting $NAME as `whoami`"

# Activate the virtual environment.
cd $DJANGODIR
. {{ venv_dir }}/bin/activate

exec gunicorn \
    --name $NAME \
    --workers $NUM_WORKERS \
    --max-requests $MAX_REQUESTS \
    --user $USER --group $GROUP \
    --log-level debug \
    --bind unix:$SOCKFILE \
    {{ app_name }}.wsgi
